name: Test Protocol

author: Autoprotocol
info: A PCR protocol written by Autoprotocol
version: '0.1'

modules:
- name: ot2bioalpha
- name: biopf400
- name: hidex_geraldine
- name: bio_biometra3
- name: bio_sealer
- name: bio_peeler

flowdef:

################################
# Run OT-2
################################

# We could specify what the protocol is and put it into the payload. Don't have to.
# Payload would be defined in the experiment app.
- action: run_protocol
  name: Run liquid protocol
  module: ot2bioalpha
  files:
    protocol: payload.ot2_protocol # Hardcode a path here?

################################
# Seal
################################

- action: transfer
  name: Transfer the destination plate from OT-2 to exchange
  module: biopf400
  args:
    source: ot2bioalpha_deck1_wide
    source_approach: safe_path_ot2bioalpha
    source_plate_rotation: wide
    target: exchange_deck_high_wide
    target_approach: safe_path_exchange
    target_plate_rotation: wide

- action: transfer
  name: Transfer the destination plate from exchange to Sealer
  module: biopf400
  args:
    source: exchange_deck_low_narrow
    source_approach: safe_path_exchange
    source_plate_rotation: narrow
    target: sealer_nest
    target_approach: safe_path_sealer
    target_plate_rotation: narrow

- action: seal
  name: Seal the plate
  module: bio_sealer
  args: {}

################################
# Thermocycler
################################

- action: open
  name: Open the lid of the Biometra thermocycler
  module: bio_biometra3
  args: {}

- action: transfer
  name: Transfer the destination plate from _ to exchange
  module: biopf400
  args:
    source: sealer_nest
    source_approach: safe_path_sealer
    source_plate_rotation: narrow
    target: exchange_deck_low_narrow
    target_approach: safe_path_exchange
    target_plate_rotation: narrow

- action: transfer
  name: Transfer the destination plate from exchange to _
  module: biopf400
  args:
    source: exchange_deck_low_wide
    source_approach: safe_path_exchange
    source_plate_rotation: wide
    target: bio_biometra3_nest
    target_approach: safe_path_biometra3
    target_plate_rotation: wide

- action: close
  name: Close the lid of the Biometra thermocycler
  module: bio_biometra3
  args: {}

- action: run_program
  name: Run thermocycling protocol 5 on Biometra thermocycler
  module: bio_biometra3
  args:
    program_number: 5

- action: open
  name: Open the lid of the Biometra thermocycler
  module: bio_biometra3
  args: {}

################################
# Peel
################################

- action: transfer
  name: Transfer the destination plate from OT-2 to Sealer
  module: biopf400
  args:
    source: bio_biometra3_nest
    source_approach: safe_path_biometra3
    source_plate_rotation: wide
    target: exchange_deck_low_wide
    target_approach: safe_path_exchange
    target_plate_rotation: wide

- action: transfer
  name: Transfer the destination plate from OT-2 to Sealer
  module: biopf400
  args:
    source: exchange_deck_low_narrow
    source_approach: safe_path_exchange
    source_plate_rotation: narrow
    target: peeler_nest
    target_approach: safe_path_peeler
    target_plate_rotation: narrow

- action: peel
  name: Peel the plate
  module: bio_peeler
  args: {}

################################
# Hidex
################################

- action: open
  name: Open the lid of the Hidex plate reader
  module: hidex_geraldine
  args: {}

- action: transfer
  name: Transfer the destination plate from Peeler to Hidex
  module: biopf400
  args:
    source: peeler_nest
    source_approach: safe_path_peeler
    source_plate_rotation: narrow
    target: hidex_geraldine_low_nest
    target_approach: safe_path_hidex
    target_plate_rotation: narrow

- action: close
  name: Close the lid of the Hidex plate reader
  module: hidex_geraldine
  args: {}

- action: run_assay
  name: Run assay protocol on Hidex plate reader
  module: hidex_geraldine
  args:
    assay_name: "PCR_Final_Results"

- action: open
  name: Open the lid of the Hidex plate reader
  module: hidex_geraldine
  args: {}
