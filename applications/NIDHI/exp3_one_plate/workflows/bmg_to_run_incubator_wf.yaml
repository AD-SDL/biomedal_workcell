name: Transfer from BMG to incubator, then incubate - Substrate App Workflow

metadata:
  author: Casey Stone
  info: Workflow for transfer from bmg to incubator and incubation
  version: 0.1

# TESTED AND WORKING

flowdef:
  # open the BMG - might be redundant
  - name: open bmg
    module: bio_bmg
    action: open

  # transfer from BMG to exchange
  - name: transfer from bmg to exchange
    module: biopf400
    action: transfer
    args:
      source: bmg_reader_nest
      target: exchange_deck_low_narrow
      source_approach: safe_path_bmg
      target_approach: safe_path_exchange
      source_plate_rotation: narrow
      target_plate_rotation: narrow

  # replace the lid
  - name: Replace lid on exchange
    module: biopf400
    action: replace_lid
    args:
      source: payload.lid_location
      target: exchange_deck_low_wide
      source_approach: payload.lid_safe_path
      target_approach: safe_path_exchange
      source_plate_rotation: wide
      target_plate_rotation: wide
      lid_height: 8

  - name: open incubator
    module: inheco_devID2_floor0
    action: open

  # transfer from exchange to incubator
  - name: transfer from exchange to incubator
    module: biopf400
    action: transfer
    args:
      source: exchange_deck_low_narrow
      target: payload.incubator_location
      source_approach: safe_path_exchange
      target_approach: safe_path_inheco_dev2
      source_plate_rotation: narrow
      target_plate_rotation: narrow
    comment: transfer microplate with lid to exchange

  - name: close incubator
    module: inheco_devID2_floor0
    action: close

  - name: close bmg
    module: bio_bmg
    action: close

  # run incubation
  - name: run incubation
    module: inheco_devID2_floor0
    action: incubate
    args:
      temperature: 30.0
      shaker_frequency: 6.6
      wait_for_incubation_time: False
      incubation_time: payload.incubation_seconds
    comment: incubate for specified time

