name: Incubate assay plate and replace on OT-2 deck - Substrate App Workflow

metadata:
  author: Casey Stone
  info: Workflow for running incubation/reading cycle
  version: 0.1

flowdef:
  - name: Replace lid on the assay plate on the OT-2
    module: biopf400
    action: replace_lid
    args: 
      source: lidnest1
      target: ot2bioalpha.deck1
      source_plate_rotation: narrow
      target_plate_rotation: narrow
    comment: TODO - where is lid nest 1?

  - name: Open the BMG plate reader tray
    module: bmg
    acton: open 

  - name: Transfer assay plate into BMG tray
    module: biopf400
    action: transfer
    args: 
      source: ot2bioalpha.deck1
      target: bmg.nest
      source_plate_rotation: narrow
      target_plate_rotation: narrow

  - name: Run BMG Inoculation and reading assay
    module: bmg
    action: run_assay
    args: 
      assay_name: "TODO"
    
  - name: Open the BMG plate reader tray
    module: bmg
    acton: open 

  - name: Transfer assay plate back to OT-2 deck 
    module: biopf400
    action: transfer
    args: 
      source: bmg.nest
      target: payload.assay_plate_ot2_replacement_location
      source_plate_rotation: narrow
      target_plate_rotation: narrow

    comment: TODO - will this work if the payload argument is a string? 

  - name: Remove lid from assay plate 
    module: bippf400
    action: remove_lid
    args: 
      source: payload.assay_plate_ot2_replacement_location
      target: lidnes2
      source_plate_rotation: narrow 
      target_plate_rotaiton: narrow
    comment: TODO - where is lid nest2? check that you're not swapping lids between assay plates!

